var INSOURCED=INSOURCED||{};INSOURCED.app=INSOURCED.app||{},INSOURCED.app={animations:{introAnimation:()=>{let e=document.querySelector(".form"),t=document.querySelector(".left-curtain"),a=document.querySelector(".right-curtain"),o=document.querySelector("h1"),n=document.querySelector("h2");t1=gsap.to(o,{duration:5,opacity:0,ease:"power4.out",delay:.95*INSOURCED.app.params.delay,top:"-50%"}),t2=gsap.to(n,{duration:.5,opacity:0,ease:"power4.out",delay:.95*INSOURCED.app.params.delay}),t3=gsap.to(t,{duration:3,left:"-40%",ease:"power4.out",delay:.97*INSOURCED.app.params.delay}),t4=gsap.to(a,{duration:3,right:"-40%",ease:"power4.out",delay:.97*INSOURCED.app.params.delay}),t5=gsap.to(e,{duration:.1,opacity:0,display:"none"}),t6=gsap.fromTo("body",{backgroundColor:"#000"},{backgroundColor:"#000",delay:.3,duration:.5})},songAndDance:()=>{let e=0;dance=gsap.fromTo(".dancing-man-wrapper",{scale:0,opacity:0},{opacity:1,scale:1,duration:1,ease:"elastic.out(1, 0.3)",delay:e})},spinningRecordPlay:()=>{"undefined"==typeof vinylRecord?(vinylRecord=gsap.fromTo(".vinyl-record",{opacity:0,scale:0},{opacity:1,scale:1,duration:1,ease:"elastic.out(1, 0.3)",delay:0}),vinylRecord=gsap.to(".vinyl-record",{display:"block",rotation:360,duration:1.8,repeat:-1,ease:"none"})):vinylRecord.play()},spinningRecordPause:()=>{vinylRecord.pause()},countdown:()=>{gsap.fromTo(".wait-for-it",{opacity:1,fontSize:"10px"},{opacity:0,duration:2,ease:"power4.out",fontSize:"100px"})},resetAnimations:function(){let e=document.querySelector(".form"),t=document.querySelector(".left-curtain"),a=document.querySelector(".right-curtain"),o=document.querySelector("h1"),n=document.querySelector("h2");t1=gsap.timeline(),t1=gsap.to(t,{duration:3,left:"0",ease:"power4.out",delay:0}),t1=gsap.to(a,{duration:3,right:"0",ease:"power4.out",delay:0}),t3=gsap.timeline(),t3=gsap.to(o,{duration:1,opacity:1,ease:"power4.out",delay:2,top:"15%"}),t3=gsap.to(e,{duration:0,opacity:1,display:"flex",delay:3,onComplete:()=>{document.querySelector("h2").innerHTML=""}}),t3=gsap.to(n,{duration:0,opacity:1,ease:"power4.out",delay:4})}},getYouTubeID:e=>(e=e.split(/(vi\/|v=|\/v\/|youtu\.be\/|\/embed\/)/),void 0!==e[2]?e[2].split(/[^0-9a-z_\-]/i)[0]:e[0]),getGif:()=>{let e=INSOURCED.app.params.curated_gifs;switch(e){case!0:INSOURCED.app.giphy();break;case!1:INSOURCED.app.getCuratedGif()}},getCuratedGif:()=>{let e=INSOURCED.app.params.dance_moves,t=Math.floor(Math.random()*e.length),a=e[t];INSOURCED.app.setGif(a)},setGif:e=>{document.querySelector(".dancing-man-wrapper").style.backgroundImage="url("+e+")",document.querySelector(".dancing-man-wrapper").style.opacity=0,document.querySelector(".dancing-man-wrapper-image").src=e},giphy:()=>{let e=INSOURCED.app.params.curated_gifs,t=INSOURCED.app.params.giphy;if(!e&&t){let e=50,t=Math.floor(300*Math.random())+1,a=encodeURIComponent("dancing");fetch("https://api.giphy.com/v1/gifs/search?api_key=6evYK0BaztKKyI7Fil0kHrpL6SBENnDH&q="+a+"&limit="+e+"&offset="+t+"&rating=R&lang=en").then(e=>e.json()).then(e=>{let t=e.data[Math.floor(Math.random()*e.data.length)].images.original.url;INSOURCED.app.setGif(t)})}},getCuratedVideo:()=>{let e=INSOURCED.app.params.music_videos;e=e.sort(()=>Math.random()-.5);let t=Math.floor(Math.random()*e.length),a=e[t];return a},getYoutubePlaylist:()=>new Promise((e,t)=>{const a=INSOURCED.app.params.youtube_playlist_id,o="AIzaSyApoFvPml1u7xUdlZrBEbinDNqJQAdcGco",n=`https://www.googleapis.com/youtube/v3/playlistItems?part=contentDetails,snippet&maxResults=50&playlistId=${a}&key=${o}`;fetch(n).then(e=>e.json()).then(t=>{e(t)}).catch(e=>{t(e)})}),instantiateYoutubePlayer:e=>{if("undefined"==typeof YT){var t=document.createElement("script");t.src="https://www.youtube.com/player_api",t.id="youtube-api";var a=document.getElementsByTagName("script")[0];a.parentNode.insertBefore(t,a)}else player.loadVideoById(e,0,"default");onYouTubePlayerAPIReady=(()=>{function t(){player.playVideo()}function a(t){let a=t.data;if(1===a&&INSOURCED.app.getGif(),-1===a){let e=player.getVideoData().title,t=document.querySelector(".title");e=e.replace(/\([^)]*\)/g,""),e=e.replace(/\[[^)]*\]/g,""),t.innerHTML=e;let a=document.querySelector(".modal-body-featured-artist");a.innerHTML=e}let n=INSOURCED.app.params.delay,r=setInterval(function(){let t=e,p=player.getCurrentTime(),i=player.getDuration(),l=0;p=Math.round(100*p)/100,i=Math.round(100*i)/100,0===a&&(clearInterval(r),INSOURCED.app.animations.spinningRecordPause(),INSOURCED.app.animations.resetAnimations());let d=n-1-Math.round(p);d=Math.ceil(d),d<=5&&d>0&&d!==o&&(document.querySelector(".wait-for-it").innerHTML=d,INSOURCED.app.animations.countdown(),o=d),p%.25==0&&(halfSeconds=p,l!==halfSeconds&&(halfSeconds===n&&INSOURCED.app.animations.songAndDance(t),l=halfSeconds))})}let o=0;player=new YT.Player("player",{height:"0",width:"0",videoId:e,playerVars:{playsinline:1,controls:0},events:{onReady:t,onStateChange:a}})})},init:()=>{let e=new URLSearchParams(window.location.search),t=!!e.get("v")&&e.get("v"),a=e.get("d")?e.get("d"):INSOURCED.app.params.delay,o=document.querySelector("input"),n=INSOURCED.app.params.curated_videos;if(n){let e=INSOURCED.app.getCuratedVideo();o.value=e.video,t=INSOURCED.app.getYouTubeID(e.video),INSOURCED.app.params.delay=e.delay}if(!n&&t&&(o.value="https://www.youtube.com/watch?v="+t,INSOURCED.app.params.delay=a||INSOURCED.app.params.delay),!n&&INSOURCED.app.params.youtube_playlist_id&&INSOURCED.app.getYoutubePlaylist().then(e=>{let t=e.items,n=Math.floor(Math.random()*t.length),r=t[n],p=r.snippet.resourceId.videoId;o.value="https://www.youtube.com/watch?v="+p,INSOURCED.app.params.delay=a||INSOURCED.app.params.delay}),document.querySelector("button").addEventListener("click",function(){let e=o.value,t=INSOURCED.app.getYouTubeID(e),a=t;gtag("event","click",{event_category:"button",event_label:"Lets Dance"}),INSOURCED.app.animations.introAnimation(),INSOURCED.app.instantiateYoutubePlayer(a),INSOURCED.app.animations.spinningRecordPlay(),window.history.pushState({},"",window.location.origin);var n=document.querySelector(".modal-body-share-url");n.innerHTML=window.location.href+"?v="+encodeURIComponent(a)+"&d="+encodeURIComponent(INSOURCED.app.params.delay),document.querySelector(".vinyl-record").addEventListener("click",function(){document.querySelector(".modal").classList.add("show")}),document.querySelector(".modal-close").addEventListener("click",function(){document.querySelector(".modal").classList.remove("show")})}),e&&n){let t=!!e.get("v")&&e.get("v"),a=!!e.get("d")&&e.get("d");t&&(INSOURCED.app.params.delay=a?parseInt(a):INSOURCED.app.params.delay,o.value="https://www.youtube.com/watch?v="+t)}}},document.addEventListener("DOMContentLoaded",function(e){INSOURCED.app.init()});